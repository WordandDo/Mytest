# RAG Benchmark System

å®Œæ•´çš„ RAGï¼ˆRetrieval-Augmented Generationï¼‰åŸºå‡†æµ‹è¯•ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§æ£€ç´¢ç­–ç•¥å¯¹æ¯”å®éªŒã€‚

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ç³»ç»Ÿæ¶æ„](#ç³»ç»Ÿæ¶æ„)
- [Prompt ç±»å‹](#prompt-ç±»å‹)
- [æ–‡ä»¶ç»“æ„](#æ–‡ä»¶ç»“æ„)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [æ–‡æ¡£](#æ–‡æ¡£)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### éªŒè¯è®¾ç½®

```bash
./verify_setup.sh
```

### è¿è¡Œå•ä¸ªæµ‹è¯•

```bash
# é€‰æ‹©ä¸€ä¸ªæµ‹è¯•è¿è¡Œ
./benchmark_dense.sh      # Dense æ£€ç´¢
./benchmark_sparse.sh     # Sparse æ£€ç´¢
./benchmark_hybrid.sh     # æ··åˆæ£€ç´¢
./benchmark_no_tool.sh    # æ— å·¥å…·åŸºçº¿
```

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
./run_all_benchmarks.sh
```

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Benchmark Script                          â”‚
â”‚  (benchmark_*.sh)                                            â”‚
â”‚  - å¯åŠ¨ Gateway                                               â”‚
â”‚  - è®¾ç½®ç¯å¢ƒå˜é‡ (OUTPUT_DIR, PROMPT_TYPE, etc.)               â”‚
â”‚  - è°ƒç”¨ run_rag_benchmark.sh                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              run_rag_benchmark.sh                            â”‚
â”‚  - æ”¶é›†é…ç½®å‚æ•°                                               â”‚
â”‚  - è°ƒç”¨ Python è„šæœ¬                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           src/run_parallel_rollout.py                        â”‚
â”‚  - è§£æå‘½ä»¤è¡Œå‚æ•°                                             â”‚
â”‚  - åˆ›å»ºç¯å¢ƒå®ä¾‹                                               â”‚
â”‚  - ä¼ é€’ prompt_type åˆ°ç¯å¢ƒ                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         src/envs/http_mcp_rag_env.py                         â”‚
â”‚  - æ¥æ”¶ prompt_type å‚æ•°                                      â”‚
â”‚  - é€‰æ‹©å¯¹åº”çš„ SYSTEM_PROMPT_*                                 â”‚
â”‚  - ç”Ÿæˆæœ€ç»ˆ System Prompt                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ Prompt ç±»å‹

| Type | æè¿° | é€‚ç”¨åœºæ™¯ | å·¥å…·è¦æ±‚ |
|------|------|---------|---------|
| `generic` | é€šç”¨ RAG prompt | ä»»ä½•æ£€ç´¢å·¥å…· | ä»»æ„ RAG å·¥å…· |
| `no_tool` | ä¸ä½¿ç”¨å·¥å…· | å»ºç«‹åŸºçº¿ | æ—  |
| `sparse` | å…³é”®è¯æ£€ç´¢ä¼˜åŒ– | BM25 æ£€ç´¢ | Sparse æ£€ç´¢å·¥å…· |
| `hybrid` | æ™ºèƒ½é€‰æ‹©æ£€ç´¢æ–¹æ³• | æ··åˆæ£€ç´¢ | Dense + Sparse å·¥å…· |

### Prompt ç‰¹ç‚¹å¯¹æ¯”

#### `generic`
- âœ… é€šç”¨æŒ‡å¯¼
- âœ… ç®€å•ç›´æ¥
- âŒ æ— ç‰¹å®šä¼˜åŒ–

#### `no_tool`
- âœ… çº¯ LLM èƒ½åŠ›
- âœ… æ— å»¶è¿Ÿå¼€é”€
- âŒ æ— æ³•è®¿é—®å¤–éƒ¨çŸ¥è¯†

#### `sparse`
- âœ… å…³é”®è¯åŒ¹é…æŒ‡å¯¼
- âœ… ç²¾ç¡®æŸ¥è¯¢ä¼˜åŒ–
- âŒ ä»…é€‚ç”¨äº BM25

#### `hybrid`
- âœ… å·¥å…·é€‰æ‹©ç­–ç•¥
- âœ… æœ€çµæ´»
- âš ï¸ éœ€è¦æ¨¡å‹æ­£ç¡®é€‰æ‹©

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
.
â”œâ”€â”€ benchmark_dense.sh              # Dense-only æµ‹è¯•è„šæœ¬
â”œâ”€â”€ benchmark_sparse.sh             # Sparse-only æµ‹è¯•è„šæœ¬
â”œâ”€â”€ benchmark_hybrid.sh             # Hybrid æµ‹è¯•è„šæœ¬
â”œâ”€â”€ benchmark_no_tool.sh            # No-tool åŸºçº¿è„šæœ¬
â”œâ”€â”€ run_all_benchmarks.sh           # è¿è¡Œæ‰€æœ‰æµ‹è¯•
â”œâ”€â”€ verify_setup.sh                 # éªŒè¯è®¾ç½®è„šæœ¬
â”‚
â”œâ”€â”€ gateway_config_rag_dense_only.json   # Dense é…ç½®
â”œâ”€â”€ gateway_config_rag_sparse_only.json  # Sparse é…ç½®
â”œâ”€â”€ gateway_config_rag_hybrid.json       # Hybrid é…ç½®
â”œâ”€â”€ gateway_config_rag_no_tool.json      # No-tool é…ç½®
â”‚
â”œâ”€â”€ run_rag_benchmark.sh            # å…±äº«çš„åŸºå‡†æµ‹è¯•è„šæœ¬
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ envs/
â”‚   â”‚   â””â”€â”€ http_mcp_rag_env.py     # RAG ç¯å¢ƒ (å« 4 ç§ prompts)
â”‚   â””â”€â”€ run_parallel_rollout.py     # å¹¶è¡Œæ‰§è¡Œè„šæœ¬
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ QUICKSTART.md                # å¿«é€Ÿå¼€å§‹æŒ‡å—
    â”œâ”€â”€ BENCHMARK_GUIDE.md           # å®Œæ•´ä½¿ç”¨æŒ‡å—
    â”œâ”€â”€ BENCHMARK_COMPARISON.md      # é…ç½®å¯¹æ¯”
    â””â”€â”€ IMPLEMENTATION_SUMMARY.md    # å®ç°ç»†èŠ‚
```

---

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ç”¨æ³•

```bash
# 1. éªŒè¯è®¾ç½®
./verify_setup.sh

# 2. è¿è¡Œæµ‹è¯•
./benchmark_dense.sh

# 3. æŸ¥çœ‹ç»“æœ
ls results/benchmark_dense_only/
```

### è‡ªå®šä¹‰å‚æ•°

```bash
# ä¿®æ”¹æ•°æ®é›†
export DATA_PATH="src/data/my_dataset.json"

# ä¿®æ”¹ rollout æ•°é‡
export NUM_ROLLOUTS=20

# ä¿®æ”¹æ¨¡å‹
export MODEL_NAME="gpt-4"

# è¿è¡Œæµ‹è¯•
./benchmark_hybrid.sh
```

### å¯¹æ¯”å®éªŒ

```bash
# æ–¹æ¡ˆ 1: æŒ‰é¡ºåºè¿è¡Œæ‰€æœ‰æµ‹è¯•
./run_all_benchmarks.sh

# æ–¹æ¡ˆ 2: å•ç‹¬è¿è¡Œå¹¶å¯¹æ¯”
./benchmark_no_tool.sh   # åŸºçº¿
./benchmark_dense.sh     # Dense
./benchmark_sparse.sh    # Sparse
./benchmark_hybrid.sh    # Hybrid

# æŸ¥çœ‹æ‰€æœ‰ç»“æœ
ls results/
```

---

## ğŸ“š æ–‡æ¡£

### å¿«é€Ÿå‚è€ƒ
- **[QUICKSTART.md](QUICKSTART.md)** - 5 åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹

### è¯¦ç»†æŒ‡å—
- **[BENCHMARK_GUIDE.md](BENCHMARK_GUIDE.md)** - å®Œæ•´çš„ä½¿ç”¨æŒ‡å—å’Œé…ç½®è¯´æ˜
- **[BENCHMARK_COMPARISON.md](BENCHMARK_COMPARISON.md)** - è¯¦ç»†çš„é…ç½®å¯¹æ¯”å’Œå®éªŒè®¾è®¡å»ºè®®

### æŠ€æœ¯æ–‡æ¡£
- **[IMPLEMENTATION_SUMMARY.md](IMPLEMENTATION_SUMMARY.md)** - å®ç°ç»†èŠ‚å’ŒæŠ€æœ¯è¯´æ˜

---

## âš™ï¸ é…ç½®è¯´æ˜

### é»˜è®¤å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `DATA_PATH` | `src/data/bamboogle.json` | æµ‹è¯•æ•°æ®é›† |
| `NUM_ROLLOUTS` | 10 (æˆ– 5) | å¹¶è¡Œä»»åŠ¡æ•° |
| `MODEL_NAME` | `openai/gpt-oss-120b` | LLM æ¨¡å‹ |
| `MAX_TURNS` | 15 | æœ€å¤§å¯¹è¯è½®æ¬¡ |
| `GATEWAY_PORT` | 8080 | Gateway ç«¯å£ |

### ç¯å¢ƒå˜é‡

æ‰€æœ‰è„šæœ¬æ”¯æŒä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```bash
export OUTPUT_DIR="results/my_test"           # è¾“å‡ºç›®å½•
export DATA_PATH="src/data/my_data.json"      # æ•°æ®è·¯å¾„
export NUM_ROLLOUTS=20                        # Rollout æ•°é‡
export GATEWAY_CONFIG_PATH="my_config.json"   # Gateway é…ç½®
export PROMPT_TYPE="hybrid"                   # Prompt ç±»å‹
export MODEL_NAME="gpt-4"                     # æ¨¡å‹åç§°
export MAX_TURNS=20                           # æœ€å¤§è½®æ¬¡
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### ç«¯å£å ç”¨

```bash
# æ¸…ç†ç«¯å£ 8080
lsof -ti:8080 | xargs kill -9
```

### Gateway å¯åŠ¨å¤±è´¥

```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
ls gateway_config_rag_*.json

# æ‰‹åŠ¨å¯åŠ¨æµ‹è¯•
python src/mcp_server/main.py --config gateway_config_rag_hybrid.json --port 8080
```

### æ•°æ®æ–‡ä»¶ç¼ºå¤±

```bash
# æ£€æŸ¥æ•°æ®æ–‡ä»¶
ls src/data/bamboogle.json

# ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®
export DATA_PATH="path/to/your/data.json"
```

---

## ğŸ“Š ç»“æœåˆ†æ

### è¾“å‡ºç›®å½•ç»“æ„

```
results/
â”œâ”€â”€ benchmark_dense_only/
â”‚   â”œâ”€â”€ rollout_logs/
â”‚   â”œâ”€â”€ metrics.json
â”‚   â””â”€â”€ summary.txt
â”œâ”€â”€ benchmark_sparse_only/
â”œâ”€â”€ benchmark_hybrid/
â””â”€â”€ benchmark_no_tool/
```

### è¯„ä¼°æŒ‡æ ‡

- **exact_match**: ç²¾ç¡®åŒ¹é…ç‡
- **f1_score**: Token çº§åˆ« F1 åˆ†æ•°

---

## ğŸ“ å®éªŒå»ºè®®

### å®éªŒ 1: åŸºçº¿å¯¹æ¯”
```bash
./benchmark_no_tool.sh    # å»ºç«‹åŸºçº¿
./benchmark_dense.sh      # å¯¹æ¯” Dense RAG
```

### å®éªŒ 2: æ–¹æ³•å¯¹æ¯”
```bash
./benchmark_dense.sh      # Dense æ£€ç´¢
./benchmark_sparse.sh     # Sparse æ£€ç´¢
# åˆ†æ: å“ªç§æ–¹æ³•æ›´é€‚åˆä½ çš„æ•°æ®ï¼Ÿ
```

### å®éªŒ 3: æ··åˆä¼˜åŒ–
```bash
./benchmark_hybrid.sh     # æ··åˆæ£€ç´¢
# åˆ†æ: æ˜¯å¦æ­£ç¡®é€‰æ‹©äº†æ£€ç´¢æ–¹æ³•ï¼Ÿ
```

### å®éªŒ 4: å®Œæ•´è¯„ä¼°
```bash
./run_all_benchmarks.sh
# å…¨é¢å¯¹æ¯”å››ç§é…ç½®
```

---

## ğŸ” é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰ Prompt

ç¼–è¾‘ `src/envs/http_mcp_rag_env.py`:

```python
SYSTEM_PROMPT_CUSTOM = """Your custom prompt here"""

# åœ¨ get_system_prompt ä¸­æ·»åŠ :
elif prompt_type == "custom":
    prompt = SYSTEM_PROMPT_CUSTOM
```

### è‡ªå®šä¹‰ Gateway é…ç½®

åˆ›å»ºæ–°çš„é…ç½®æ–‡ä»¶å¹¶åœ¨è„šæœ¬ä¸­ä½¿ç”¨ï¼š

```bash
export GATEWAY_CONFIG_PATH="my_custom_config.json"
./run_rag_benchmark.sh
```

---

## ğŸ“ˆ æ€§èƒ½é¢„æœŸ

| é…ç½® | ç›¸å¯¹é€Ÿåº¦ | ç²¾ç¡®åº¦ | è¯­ä¹‰ç†è§£ | é€‚ç”¨åœºæ™¯ |
|------|---------|--------|---------|---------|
| Dense | ä¸­ç­‰ | ä¸­ | â­â­â­ | æ¦‚å¿µæ€§é—®é¢˜ |
| Sparse | å¿« | â­â­â­ | ä½ | äº‹å®æ€§é—®é¢˜ |
| Hybrid | è¾ƒæ…¢ | â­â­â­ | â­â­â­ | æ··åˆé—®é¢˜ |
| No Tool | å¿« | ä½ | ä¸­ | åŸºçº¿å‚è€ƒ |

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

## ğŸ“„ License

æ ¹æ®é¡¹ç›®çš„ LICENSE æ–‡ä»¶ã€‚

---

## ğŸ“® è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹æ–‡æ¡£æˆ–æäº¤ Issueã€‚

---

**æœ€åæ›´æ–°**: 2025-12-08
